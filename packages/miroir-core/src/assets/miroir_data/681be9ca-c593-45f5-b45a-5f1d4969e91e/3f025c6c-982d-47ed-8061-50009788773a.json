{
  "uuid": "3f025c6c-982d-47ed-8061-50009788773a",
  "parentName":"TransformerTest",
  "parentUuid":"681be9ca-c593-45f5-b45a-5f1d4969e91e",
  "name":"resolveConditionalSchema",
  "selfApplication":"21840247-b5b1-4344-baec-f818f4797d92",
  "branch":"ad1ddc4e-556e-4598-9cff-706a2bde0be7",
  "description": "The Test for the resolveConditionalSchema Transformer",
  "definition": {
    "transformerTestType": "transformerTestSuite",
    "transformerTestLabel": "resolveConditionalSchema",
    "transformerTests": [
      {
        "transformerTestType": "transformerTest",
        "transformerTestLabel": "returns the original schema if no conditionalMMLS tag is present",
        "transformerName": "resolveConditionalSchema",
        "runTestStep": "build",
        "transformer": {
          "transformerType": "resolveConditionalSchema",
          "interpolation": "build",
          "schema": { "type": "string" },
          "valueObject": "test",
          "context": "defaultValue",
          "valuePath": []
        },
        "transformerParams": {},
        "expectedValue": { "type": "string" }
      },
      {
        "transformerTestType": "transformerTest",
        "transformerTestLabel": "returns the original schema if conditionalMMLS tag is present but no parentUuid",
        "transformerName": "resolveConditionalSchema",
        "runTestStep": "build",
        "transformer": {
          "transformerType": "resolveConditionalSchema",
          "interpolation": "build",
          "schema": { "type": "string", "tag": { "value": { "conditionalMMLS": {} } } },
          "valueObject": "test",
          "context": "defaultValue",
          "valuePath": []
        },
        "transformerParams": {},
        "expectedValue": { "type": "string", "tag": { "value": { "conditionalMMLS": {} } } }
      },
      {
        "transformerTestType": "transformerTest",
        "transformerTestLabel": "error if parentUuid path specified but not given deploymentUuid",
        "transformerName": "resolveConditionalSchema",
        "runTestStep": "build",
        "transformer": {
          "transformerType": "resolveConditionalSchema",
          "interpolation": "build",
          "schema": {
            "type": "any",
            "tag": {
              "value": {
                "conditionalMMLS": {
                  "parentUuid": { "path": "#.notExistingAttribute" }
                }
              }
            }
          },
          "valueObject": {},
          "context": "defaultValue",
          "valuePath": ["c", "d"]
        },
        "transformerParams": {},
        "expectedValue": {
          "error": "NO_DEPLOYMENT_UUID"
        }
      },
      {
        "transformerTestType": "transformerTest",
        "transformerTestLabel": "error if no value found at given parentUuid path",
        "transformerName": "resolveConditionalSchema",
        "runTestStep": "build",
        "transformer": {
          "transformerType": "resolveConditionalSchema",
          "interpolation": "build",
          "deploymentUuid": "10ff36f2-50a3-48d8-b80f-e48e5d13af8e",
          "schema": {
            "type": "any",
            "tag": {
              "value": {
                "conditionalMMLS": {
                  "parentUuid": { "path": "#.notExistingAttribute" }
                }
              }
            }
          },
          "valueObject": {},
          "context": "defaultValue",
          "valuePath": ["c", "d"]
        },
        "transformerParams": {},
        "expectedValue": {
          "error": "INVALID_PARENT_UUID_CONFIG",
          "details": "parentUuid resolution failed: {\n  \"error\": \"INITIAL_PATH_SEGMENT_NOT_FOUND\",\n  \"segment\": \"c\",\n  \"current\": {}\n}"
        }
      },
      {
        "transformerTestType": "transformerTest",
        "transformerTestLabel": "fails when wrong parentUuid is given",
        "transformerName": "resolveConditionalSchema",
        "runTestStep": "build",
        "transformer": {
          "transformerType": "resolveConditionalSchema",
          "interpolation": "build",
          "schema": {
            "type": "any",
            "tag": {
              "value": { "conditionalMMLS": { "parentUuid": { "path": "#.e" } } }
            }
          },
          "deploymentUuid": "f714bb2f-a12d-4e71-a03b-74dcedea6eb4",
          "valueObject": {
            "a": { "b": "test" },
            "c": { 
              "e": "WRONG_UUID",
              "d": {
                "uuid": "caef8a59-39eb-48b5-ad59-a7642d3a1e8f",
                "parentName": "Book",
                "parentUuid": "e8ba151b-d68e-4cc3-9a83-3459d309ccf5",
                "conceptLevel": "Data",
                "name": "Et dans l'éternité je ne m'ennuierai pas",
                "author": "ce7b601d-be5f-4bc6-a5af-14091594046a",
                "publisher": "516a7366-39e7-4998-82cb-80199a7fa667"
              }
           }
          },
          "context": "defaultValue",
          "valuePath": ["c", "d"]
        },
        "transformerParams": {},
        "expectedValue": {
          "error": "PARENT_NOT_FOUND",
          "details": "No entity definition found for parentUuid WRONG_UUID in deployment f714bb2f-a12d-4e71-a03b-74dcedea6eb4"
        }
      },
      {
        "transformerTestType": "transformerTest",
        "transformerTestLabel": "resolves schema using legacy single path configuration",
        "transformerName": "resolveConditionalSchema",
        "runTestStep": "build",
        "transformer": {
          "transformerType": "resolveConditionalSchema",
          "interpolation": "build",
          "schema": {
            "type": "any",
            "tag": {
              "value": { "conditionalMMLS": { "parentUuid": { "path": "#.e" } } }
            }
          },
          "deploymentUuid": "f714bb2f-a12d-4e71-a03b-74dcedea6eb4",
          "valueObject": {
            "a": { "b": "test" },
            "c": { 
              "e": "e8ba151b-d68e-4cc3-9a83-3459d309ccf5",
              "d": {
                "uuid": "caef8a59-39eb-48b5-ad59-a7642d3a1e8f",
                "parentName": "Book",
                "parentUuid": "e8ba151b-d68e-4cc3-9a83-3459d309ccf5",
                "conceptLevel": "Data",
                "name": "Et dans l'éternité je ne m'ennuierai pas",
                "author": "ce7b601d-be5f-4bc6-a5af-14091594046a",
                "publisher": "516a7366-39e7-4998-82cb-80199a7fa667"
              }
           }
          },
          "context": "defaultValue",
          "valuePath": ["c", "d"]
        },
        "transformerParams": {},
        "expectedValue": {
          "type": "object",
          "definition": {
            "uuid": {
              "type": "uuid",
              "tag": {
                "value": {
                  "id": 1,
                  "defaultLabel": "Uuid",
                  "editable": false
                }
              }
            },
            "parentName": {
              "type": "string",
              "optional": true,
              "tag": {
                "value": {
                  "id": 2,
                  "defaultLabel": "Entity Name",
                  "editable": false
                }
              }
            },
            "parentUuid": {
              "type": "uuid",
              "tag": {
                "value": {
                  "id": 3,
                  "defaultLabel": "Entity Uuid",
                  "editable": false
                }
              }
            },
            "conceptLevel": {
              "type": "enum",
              "definition": ["MetaModel", "Model", "Data"],
              "optional": true,
              "tag": {
                "value": {
                  "id": 5,
                  "defaultLabel": "Concept Level",
                  "editable": false
                }
              }
            },
            "name": {
              "type": "string",
              "tag": {
                "value": {
                  "id": 4,
                  "defaultLabel": "Name",
                  "editable": true
                }
              }
            },
            "author": {
              "type": "uuid",
              "optional": true,
              "tag": {
                "value": {
                  "id": 5,
                  "editable": true,
                  "defaultLabel": "Author",
                  "targetEntity": "d7a144ff-d1b9-4135-800c-a7cfc1f38733",
                  "selectorParams": {
                    "targetEntity": "d7a144ff-d1b9-4135-800c-a7cfc1f38733",
                    "targetEntityOrderInstancesBy": "name"
                  }
                }
              }
            },
            "publisher": {
              "type": "uuid",
              "optional": true,
              "tag": {
                "value": {
                  "id": 5,
                  "editable": true,
                  "defaultLabel": "Publisher",
                  "targetEntity": "a027c379-8468-43a5-ba4d-bf618be25cab",
                  "selectorParams": {
                    "targetEntity": "a027c379-8468-43a5-ba4d-bf618be25cab",
                    "targetEntityOrderInstancesBy": "name"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
